<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
		<meta content="yes" name="apple-mobile-web-app-capable">
		<meta content="black" name="apple-mobile-web-app-status-bar-style">
		<meta content="telephone=no" name="format-detection">
		<meta content="email=no" name="format-detection">
		<title></title>
		<link rel="stylesheet" href="../public.css" />
		<style>
			.wrap {}
			
			.album {
				width: 100%;
				height: 100%;
				margin: auto;
				background: #000000;
			}
			
			.album ul li {
				float: left;
				/*background-size: 100%;*/
			}
		</style>
	</head>

	<body style="background:#000000">
		<span class="Ac"></span>
		<div class="wrap">
			<div id="album" class="album">
				<ul id="piclist">

				</ul>
			</div>
		</div>
		<script type="text/javascript" src="js/touch.js"></script>
		<script>
			function Album(arrimg) {
				this.albumbox = document.getElementById('album');
				this.piclist = document.getElementById('piclist')
				this.w_w = window.innerWidth;
				this.w_h = window.innerHeight;
				this.arrimg = arrimg;
				this.arrimg_length = this.arrimg.length;
				this.nowi = 0;
				this.direction = 'left'
			}
			var P_album = Album.prototype
			P_album.init = function() {
				var u = navigator.userAgent;
				var ua = window.navigator.userAgent.toLowerCase();
				var checkU = {
					isAndroid: function() {
						if (u.indexOf('Android') > -1 || u.indexOf('Linux') > -1) {
							return true;
						}
					},
					isWeiXin: function() {
						if (ua.match(/MicroMessenger/i) == 'micromessenger') {
							return true;
						}
					}
				}
				this.albumbox.style.height = this.w_h + 'px';
				this.albumbox.style.width = this.w_w * this.arrimg_length + 'px';
				this.albumbox.style.webkitTransition = '0.3s linear';
				this.initList();
				this.acitonListener();
				this.isAndroidWX = (checkU.isAndroid() && checkU.isWeiXin())
			}
			P_album.initList = function() {
				var self = this
				for (i = 0; i < self.arrimg_length; i++) {
					var _li = document.createElement('li');
					_li.style.height = self.w_h + 'px';
					_li.style.width = self.w_w + 'px';
					_li.setAttribute('data-src', self.arrimg[i]);
					if (i == 0) {
						_li.style.backgroundImage = "url('" + self.arrimg[i] + "')";
					} else {
						_li.style.backgroundImage = "url(images/loading.gif)";
					}
					_li.style.backgroundSize = '100%';
					_li.style.backgroundRepeat = 'no-repeat';
					_li.style.backgroundPosition = 'center';
					self.piclist.appendChild(_li);
				}
			}
			P_album.changeBkImgUrl = function(i) {
				var self = this;
				self.piclistli = self.piclist.querySelectorAll('li');
				var _imgurl = self.piclistli[i].getAttribute('data-src');
				var _src = 'url("' + _imgurl + '")';
				var _bkimg = self.piclistli[i].style.backgroundImage;
				if (_src == _bkimg) {
					return;
				}
				self.piclistli[i].style.webkitTransition = '0.3s linear';
				var _img = new Image();
				_img.src = _imgurl;
				_img.onload = function() {
					self.piclistli[i].style.backgroundSize = '100%';
					self.piclistli[i].style.backgroundImage = _src;
				}
			}
			P_album.acitonListener = function() {
				var self = this;
				var dx;
				//				self.albumbox.addEventListener( ,function(ev){
				touch.on(self.albumbox, 'drag', function(ev) {
					dx = dx || 0;
					var offx = dx + ev.x + "px";
					if(self.isAndroidWX){
						return
					}
					self.albumbox.style.webkitTransform = "translate3d(" + offx + ",0,0)";
				})
				touch.on(self.albumbox, 'dragend', function(ev) {
					if (ev.x < 0 && ev.x < -80) {
						self.direction = 'left';
						self.computeNowi();
						self.albumbox.style.webkitTransform = "translateX(-" + self.w_w * self.nowi + "px)";
						dx = -self.w_w * self.nowi;
					} else if (ev.x > 0 && ev.x > 80) {
						self.direction = 'right';
						self.computeNowi();
						self.albumbox.style.webkitTransform = "translateX(-" + self.w_w * self.nowi + "px)";
						dx = -self.w_w * self.nowi;
					} else {
						//没达到拖动标准距离反弹回去
						self.albumbox.style.webkitTransform = "translateX(-" + self.w_w * self.nowi + "px)";
					}
				});
				document.addEventListener('touchstart', function(e) {
					e.preventDefault();
				}, false)
				self.albumbox.addEventListener('tap', function(e) {
					e.preventDefault();
				}, false)
				self.albumbox.addEventListener('touchstart', function(e) {
					e.preventDefault();
				}, false)
				self.albumbox.addEventListener('webkitTransitionEnd', function() {
					self.changeBkImgUrl(self.nowi);
				}, false)
			}
			P_album.computeNowi = function() {
				if (this.direction == 'left') {
					this.nowi++;
					this.nowi = this.nowi < (this.arrimg_length - 1) ? this.nowi : (this.arrimg_length - 1);
					console.log(this.nowi);
				} else if (this.direction == 'right') {
					this.nowi--;
					this.nowi = this.nowi > 0 ? this.nowi : 0;
				}
			}
			var imgarr = ['http://7xl619.com1.z0.glb.clouddn.com/124%20(1).jpg',
				'http://7xl619.com1.z0.glb.clouddn.com/124%20(2).jpg',
				'http://7xl619.com1.z0.glb.clouddn.com/124%20(3).jpg',
				'http://7xl619.com1.z0.glb.clouddn.com/124%20(4).jpg',
				'http://7xl619.com1.z0.glb.clouddn.com/124%20(5).jpg',
				'http://7xl619.com1.z0.glb.clouddn.com/124%20(6).jpg',
				'http://7xl619.com1.z0.glb.clouddn.com/124%20(7).jpg',
				'http://7xl619.com1.z0.glb.clouddn.com/124%20(8).jpg',
				'http://7xl619.com1.z0.glb.clouddn.com/124%20(9).jpg',
				'http://7xl619.com1.z0.glb.clouddn.com/124%20(10).jpg'
			]
			var album = new Album(imgarr)
			album.init()
		</script>
	</body>

</html>